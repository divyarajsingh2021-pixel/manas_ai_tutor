<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manas AI Tutor | LakeCity Hackathon</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;800&display=swap" rel="stylesheet">
    <style>
        body { background: #020617; color: white; font-family: 'Outfit', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px); padding: 2rem; border-radius: 24px; width: 90%; max-width: 500px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        #chat { height: 300px; overflow-y: auto; margin: 20px 0; text-align: left; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 15px; }
        .msg { margin: 10px 0; padding: 10px; border-radius: 10px; line-height: 1.4; }
        .ai { background: #334155; border-left: 4px solid #6366f1; }
        .user { background: #4f46e5; margin-left: 15%; }
        #mic { width: 70px; height: 70px; border-radius: 50%; border: none; background: #6366f1; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 0 20px rgba(99, 102, 241, 0.4); }
        .listening { background: #ef4444 !important; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    <div class="card">
        <h2 style="margin-top:0; color:#818cf8;">MANAS AI</h2>
        <div id="chat"><div class="msg ai"><b>Guru:</b> Namaste! I am ready. Click the mic and ask me any IT question in Mewari or Hindi!</div></div>
        <button id="mic" onclick="startRec()">ðŸŽ¤</button>
        <p id="status" style="margin-top:15px; color:#94a3b8; font-size:0.8rem;">SYSTEM READY</p>
    </div>

    <script>
        const KEY = "AIzaSyACld04lU7VGlrGQbPtyA5lscGiy7yNVN4";
        let rec;

        if ('webkitSpeechRecognition' in window) {
            rec = new webkitSpeechRecognition();
            rec.lang = 'hi-IN';
            rec.onstart = () => { document.getElementById('mic').className = 'listening'; document.getElementById('status').innerText = "LISTENING..."; };
            rec.onend = () => { document.getElementById('mic').className = ''; document.getElementById('status').innerText = "PROCESSING..."; };
            rec.onresult = (e) => { 
                const t = e.results[0][0].transcript; 
                addMsg(t, 'user'); 
                callAI(t); 
            };
        }

        function startRec() { window.speechSynthesis.cancel(); rec.start(); }
        function addMsg(t, s) { const c = document.getElementById('chat'); c.innerHTML += `<div class="msg ${s}">${t}</div>`; c.scrollTop = c.scrollHeight; }

        async function callAI(q) {
            try {
                // Using the v1 STABLE endpoint to avoid the "Model Not Found" error
                const r = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${KEY}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: "Explain in 2 simple sentences in Hindi/Mewari: " + q }] }] })
                });
                const d = await r.json();
                const ans = d.candidates[0].content.parts[0].text;
                addMsg(ans, 'ai');
                const s = new SpeechSynthesisUtterance(ans); s.lang = 'hi-IN'; window.speechSynthesis.speak(s);
                document.getElementById('status').innerText = "SYSTEM READY";
            } catch (err) {
                addMsg("Error connecting. Please ensure your API key is active.", "ai");
                document.getElementById('status').innerText = "ERROR";
            }
        }
    </script>
</body>
</html>